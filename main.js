(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-10",headers:{authorization:"9b905344-3d05-4d05-a4c9-656bee7e15b5","Content-Type":"application/json"}},t=function(t){return fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:{authorization:"9b905344-3d05-4d05-a4c9-656bee7e15b5"}}).then((function(e){return e.json()})).catch((function(e){return console.log(e)}))},n=function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:"9b905344-3d05-4d05-a4c9-656bee7e15b5"}}).then((function(e){return e.json()})).catch((function(e){return console.log(e)}))},r=function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:"9b905344-3d05-4d05-a4c9-656bee7e15b5"}}).then((function(e){return e.json()})).catch((function(e){return console.log(e)}))};function o(e,n){t(n).then((function(){return e.remove()}))}function c(e,t,o){e.classList.contains("card__like-button_is-active")?r(t).then((function(t){e.classList.toggle("card__like-button_is-active"),o.textContent=t.likes.length})):n(t).then((function(t){e.classList.toggle("card__like-button_is-active"),o.textContent=t.likes.length}))}var u=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&i(t)}};function a(e){e.classList.add("popup_is-opened"),console.log(e),document.addEventListener("keydown",u)}function i(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u)}var l=function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));r&&(t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent="")};function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){var r,o,c,u;r=e,o=t,c=n[t],u=function(e,t){if("object"!=s(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),(o="symbol"==s(u)?u:String(u))in r?Object.defineProperty(r,o,{value:c,enumerable:!0,configurable:!0,writable:!0}):r[o]=c})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f=document.querySelector(".content").querySelector(".places__list"),m=document.querySelector("#card-template").content,v=document.querySelector(".profile__edit-button"),y=document.querySelector(".profile__add-button"),_=document.querySelectorAll(".popup__close"),b=document.querySelector(".profile__image-edit"),h=document.querySelector(".popup_type_edit"),S=document.querySelector(".popup_type_new-card"),g=document.querySelector(".popup_type_new-avatar"),q=document.querySelector(".popup_type_image"),E=document.querySelector(".popup__image"),L=document.querySelector(".popup__caption"),C=document.querySelector('form[name="edit-profile"]'),k=document.querySelector('form[name="new-place"]'),j=document.querySelector('form[name="new-avatar"]'),O=document.querySelector(".popup__input_type_name"),w=document.querySelector(".popup__input_type_description"),x=document.querySelector(".popup__input_type_card-name"),P=document.querySelector(".popup__input_type_url"),D=document.querySelector(".popup__input_type_url-avatar"),U=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),T=document.querySelector(".profile__image"),B=null,M={formElement:".popup__form",inputElement:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button-disabled",inputErrorClass:"popup__input_type-error",errorClass:"popup__input-error-visible"},z=function(e,t,n){return function(r){e(r),function(e,t,n){var r=Array.from(e.querySelectorAll(t.inputElement)),o=e.querySelector(t.submitButtonSelector);r.forEach((function(n){l(e,n,t)})),n&&function(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)}(o,t)}(t,M,n)}};!function(e){Array.from(document.querySelectorAll(e.formElement)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputElement)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){var r=t.validity;r.patternMismatch||r.typeMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),r.valid?l(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));o&&(t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass))}(e,t,t.validationMessage,n)}(e,o,t),function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}(n,r,t)}))}))}(t,e)}))}(M);var N=function(e,t){E.src=t,E.alt=e,L.textContent=e,a(q)};function J(e,t){var n=function(e,t,n,r,o,c){var u=o.querySelector(".card").cloneNode(!0),a=e.name,i=e.link,l=e.isMine,s=e._id,d=e.likes;u.querySelector(".card__title").textContent=a;var p=u.querySelector(".card__image");p.src=i,p.alt=a,p.addEventListener("click",(function(){return c(a,i)}));var f=u.querySelector(".card__delete-button");f.addEventListener("click",(function(){return n(u,s)})),l||f.remove();var m=d.some((function(e){return e._id===t})),v=u.querySelector(".card__like-button"),y=u.querySelector(".card__likes-amount");return m&&v.classList.toggle("card__like-button_is-active"),y.textContent=d.length,v.addEventListener("click",(function(){return r(v,s,y)})),u}(e,B,o,c,m,N);t?f.prepend(n):f.append(n)}function H(e){e.target.querySelector(".popup__button").textContent="Сохранение..."}function V(e){e.target.querySelector(".popup__button").textContent="Сохранить"}fetch("".concat(e.baseUrl,"/users/me"),{headers:{authorization:"9b905344-3d05-4d05-a4c9-656bee7e15b5"}}).then((function(e){return e.json()})).catch((function(e){return console.log(e)})).then((function(t){U.textContent=t.name,A.textContent=t.about,T.src=t.avatar,B=t._id,fetch("".concat(e.baseUrl,"/cards"),{headers:{authorization:"9b905344-3d05-4d05-a4c9-656bee7e15b5"}}).then((function(e){return e.json()})).catch((function(e){return console.log(e)})).then((function(e){e.map((function(e){return p(p({},e),{},{isMine:e.owner._id==t._id})})).forEach((function(e){return J(e)}))}))})),v.addEventListener("click",z((function(){O.value="".concat(U.textContent),w.value="".concat(A.textContent),a(h)}),C)),b.addEventListener("click",z((function(){D.value="".concat(T.src),a(g)}),j)),y.addEventListener("click",z((function(){return a(S)}),k,!0)),_.forEach((function(e){return e.addEventListener("click",(function(e){return i(e.target.parentNode.parentNode)}))})),document.addEventListener("click",(function(e){e.target.classList.contains("popup_is-opened")&&i(e.target)})),C.addEventListener("submit",(function(t){t.preventDefault(),H(t);var n,r=O.value,o=w.value;(n={name:O.value,about:w.value},fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n.name,about:n.about})}).then((function(e){return e.json()})).catch((function(e){return console.log(e)}))).then((function(){V(t),U.textContent=r,A.textContent=o,i(h)}))})),k.addEventListener("submit",z((function(t){var n;t.preventDefault(),H(t),(n={name:x.value,link:P.value},fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:n.name,link:n.link})}).then((function(e){return e.json()})).catch((function(e){return console.log(e)}))).then((function(e){V(t),J(p(p({},e),{},{isMine:!0}),!0),x.value="",P.value="",i(S)}))}),k,!0)),j.addEventListener("submit",(function(t){t.preventDefault(),H(t),function(t){return console.log(t.avatar,"here is avatar"),fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:t.avatar})}).then((function(e){return e.json()})).catch((function(e){return console.log(e)}))}({avatar:D.value}).then((function(){V(t),T.src=D.value,D.value="",i(g)}))}))})();