(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-10",headers:{authorization:"9b905344-3d05-4d05-a4c9-656bee7e15b5","Content-Type":"application/json"}},t=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},n=function(n){return fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:{authorization:e.headers.authorization}}).then(t)},r=function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:{authorization:e.headers.authorization}}).then(t)},o=function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:{authorization:e.headers.authorization}}).then(t)};function c(e,t){n(t).then((function(){return e.remove()})).catch((function(e){return console.log(e)}))}function a(e,t,n){(e.classList.contains("card__like-button_is-active")?o:r)(t).then((function(t){e.classList.toggle("card__like-button_is-active"),n.textContent=t.likes.length})).catch((function(e){return console.log(e)}))}var u=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&l(t)}};function i(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",u)}function l(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u)}var s=function(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)},d=function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));r&&(t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent="")},p=document.querySelector(".content").querySelector(".places__list"),f=document.querySelector("#card-template").content,m=document.querySelector(".profile__edit-button"),_=document.querySelector(".profile__add-button"),v=document.querySelectorAll(".popup__close"),h=document.querySelector(".profile__image-edit"),y=document.querySelector(".popup_type_edit"),S=document.querySelector(".popup_type_new-card"),b=document.querySelector(".popup_type_new-avatar"),q=document.querySelector(".popup_type_image"),E=document.querySelector(".popup__image"),L=document.querySelector(".popup__caption"),C=document.querySelector('form[name="edit-profile"]'),g=document.querySelector('form[name="new-place"]'),k=document.querySelector('form[name="new-avatar"]'),x=document.querySelector(".popup__input_type_name"),z=document.querySelector(".popup__input_type_description"),U=document.querySelector(".popup__input_type_card-name"),A=document.querySelector(".popup__input_type_url"),w=document.querySelector(".popup__input_type_url-avatar"),T=document.querySelector(".profile__title"),B=document.querySelector(".profile__description"),D=document.querySelector(".profile__image"),N=null,P={formElement:".popup__form",inputElement:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button-disabled",inputErrorClass:"popup__input_type-error",errorClass:"popup__input-error-visible"},M=function(e,t){return function(n){e(n),function(e,t){var n=Array.from(e.querySelectorAll(t.inputElement)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){d(e,n,t)})),s(r,t)}(t,P)}};!function(e){Array.from(document.querySelectorAll(e.formElement)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputElement)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){var r=t.validity;r.patternMismatch||r.typeMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),r.valid?d(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));o&&(t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass))}(e,t,t.validationMessage,n)}(e,o,t),function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):s(t,n)}(n,r,t)}))}))}(t,e)}))}(P);var O=function(e,t){E.src=t,E.alt=e,L.textContent=e,i(q)};function j(e,t){var n=function(e,t,n,r,o,c){var a=o.querySelector(".card").cloneNode(!0),u=e.name,i=e.link,l=e.owner,s=e._id,d=e.likes,p=l._id==t;a.querySelector(".card__title").textContent=u;var f=a.querySelector(".card__image");f.src=i,f.alt=u,f.addEventListener("click",(function(){return c(u,i)}));var m=a.querySelector(".card__delete-button");m.addEventListener("click",(function(){return n(a,s)})),p||m.remove();var _=d.some((function(e){return e._id===t})),v=a.querySelector(".card__like-button"),h=a.querySelector(".card__likes-amount");return _&&v.classList.toggle("card__like-button_is-active"),h.textContent=d.length,v.addEventListener("click",(function(){return r(v,s,h)})),a}(e,N,c,a,f,O);t?p.prepend(n):p.append(n)}function J(e,t){e.target.querySelector(".popup__button").textContent=t?"Сохранение...":"Сохранить"}fetch("".concat(e.baseUrl,"/users/me"),{headers:{authorization:e.headers.authorization}}).then(t).then((function(n){T.textContent=n.name,B.textContent=n.about,D.src=n.avatar,N=n._id,fetch("".concat(e.baseUrl,"/cards"),{headers:{authorization:"9b905344-3d05-4d05-a4c9-656bee7e15b5"}}).then(t).then((function(e){e.forEach((function(e){return j(e)}))})).catch((function(e){return console.log(e)}))})),m.addEventListener("click",M((function(){x.value=T.textContent,z.value=B.textContent,i(y)}),C)),h.addEventListener("click",M((function(){w.value=D.src,i(b)}),k)),_.addEventListener("click",M((function(){return i(S)}),g)),v.forEach((function(e){return e.addEventListener("click",(function(e){return l(e.target.parentNode.parentNode)}))})),document.addEventListener("click",(function(e){e.target.classList.contains("popup_is-opened")&&l(e.target)})),C.addEventListener("submit",(function(n){var r;n.preventDefault(),J(n,!0),(r={name:x.value,about:z.value},fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:r.name,about:r.about})}).then(t)).then((function(e){T.textContent=e.name,B.textContent=e.about,l(y)})).catch((function(e){return console.log(e)})).finally((function(){return J(n,!1)}))})),g.addEventListener("submit",M((function(n){var r;n.preventDefault(),J(n,!0),(r={name:U.value,link:A.value},fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:r.name,link:r.link})}).then(t)).then((function(e){j(e,!0),g.reset(),l(S)})).catch((function(e){return console.log(e)})).finally((function(){return J(n,!1)}))}),g)),k.addEventListener("submit",(function(n){n.preventDefault(),J(n,!0),function(n){return fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n.avatar})}).then(t)}({avatar:w.value}).then((function(e){D.src=e.avatar,l(b)})).catch((function(e){return console.log(e)})).finally((function(){return J(n,!1)}))}))})();